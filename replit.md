# Workly - Workforce Management Platform

## Overview

Workly is a comprehensive workforce management platform built with Flask, designed to handle employee attendance tracking, shift scheduling, leave management, and user administration. The system supports multiple user roles with different permission levels and provides a responsive web interface for managing all aspects of workforce operations.

## Project Origin

Workly is derived from the NS12 Workforce Management Platform, created as an independent development branch for enhanced customization and feature development. All NS12-specific branding has been replaced with generic "Workly Platform" branding to create a standalone product.

## System Architecture

### Backend Architecture
- **Framework**: Flask (Python web framework)
- **Database**: SQLAlchemy ORM with support for both SQLite (development) and PostgreSQL (production)
- **Authentication**: Flask-Login for session management with role-based access control
- **Forms**: WTForms with Flask-WTF for form handling and validation
- **Deployment**: Gunicorn WSGI server with autoscale deployment target

### Frontend Architecture
- **Templates**: Jinja2 templating engine with Bootstrap dark theme
- **Styling**: Bootstrap 5 with custom CSS overrides
- **JavaScript**: Vanilla JavaScript for enhanced interactivity
- **Icons**: Font Awesome for consistent iconography
- **Responsive Design**: Mobile-first approach with Bootstrap grid system

### Database Schema
The application uses SQLAlchemy models with the following key entities:
- **User**: Stores user information, roles, and part-time percentages
- **AttendanceEvent**: Tracks multiple daily attendance events (clock-in/out, breaks) with timestamp precision
- **LeaveRequest**: Manages vacation and leave requests
- **Shift**: Handles shift assignments and scheduling
- **ReperibilitaShift**: Manages on-call duty assignments
- **ReperibilitaIntervention**: Tracks on-call interventions with priority levels

## Key Features

### User Management System
- **Permission-based access control** with granular 30+ permissions for each menu functionality
- **Dynamic role management** with 5 standardized roles:
  - **Amministratore**: Full system access with all permissions
  - **Responsabile**: Local site management with operational functions
  - **Supervisore**: Global site supervision with view-only access
  - **Operatore**: Standard operational access to core functions
  - **Ospite**: Limited access for external users
- **Admin-configurable permissions**: Each role's permissions can be dynamically managed
- **Advanced work schedule assignment**: Users can be assigned specific work schedules for ORARIA mode sedes or left unassigned for TURNI mode participation
- **Multi-sede support**: Users with all_sedi access don't require specific work schedule assignment
- User creation, modification, and deactivation capabilities
- Part-time percentage tracking for specific roles
- Secure password hashing with Werkzezeug

### Attendance Tracking
- Clock-in/out functionality with timestamp recording
- Break time tracking (start/end)
- Daily attendance records with notes capability
- Historical attendance viewing and reporting
- QR code system for quick attendance marking

### Shift Management
- Intelligent shift generation with workload balancing
- Template system for recurring shift patterns
- Integration with leave requests and part-time percentages
- On-call (reperibilità) duty management with intervention tracking

### QR Code System
- Static QR code generation for deployment flexibility
- Dedicated QR pages for entry/exit tracking
- Admin controls for regenerating QR codes when server changes
- Fallback to external API when static files unavailable

## Branding Changes from NS12

### Visual Changes
- Removed NS12 logo from login page
- Replaced with Workly branding using briefcase icon
- Updated all page titles from "NS12 S.p.A." to "Workly"
- Changed footer attribution to "Workly Platform"

### Generic Branding
- No company-specific references in user interface
- Suitable for deployment by any organization
- Maintains professional appearance with generic workforce management theme

## Deployment Configuration

### Development Environment
- SQLite database for local development
- Flask development server with debug mode
- Hot reload capability for rapid development

### Production Environment
- Gunicorn WSGI server with multiple workers
- PostgreSQL database with connection pooling
- Environment variable configuration for secrets
- Autoscale deployment target on Replit

## Recent Changes
- July 30, 2025: **Documentazione Completa e Deployment Package Creato** - Creata documentazione completa per deployment e installazione: FUNCTIONALITY_DESCRIPTION.md con architettura modulare e 30+ funzionalità dettagliate, INSTALLATION_GUIDE.md con setup automatico e manuale per tutti gli ambienti, DEPLOYMENT_GUIDE.md con strategie Replit/VPS/Cloud, Dockerfile e docker-compose.yml per containerizzazione, scripts/setup.sh per installazione automatica, scripts/backup.sh e deploy.sh per gestione produzione, README.md professionale con quick start e badge, progetto ora completamente deployment-ready per qualsiasi ambiente
- July 30, 2025: **Database Test Data Popolamento Completo** - Implementato e completato popolamento database con dataset completo Luglio 2025: creati 8 utenti test con 5 ruoli (admin/mario.rossi/paolo.verdi/etc, password: "password123"), configurate tipologie ferie/straordinari/spese, generate 31 giorni presenze realistiche con orari 9-18, create 6 richieste ferie approvate/pending, 5 richieste straordinari, 6 note spese €35-280 per categorie diverse, 8 turni reperibilità weekend, 6 interventi emergenza, festività 15 luglio, sistema completamente funzionante per demo e testing
- July 30, 2025: **Ottimizzazione Completa Codice Workly Completata** - Implementata pulizia sistematica del codebase per sicurezza, performance e manutenibilità: eliminati 18 statement print() di debug sostituiti con logging professionale, rimosso file obsoleto forms_backup.py con 14 errori LSP, corretti valori hardcoded in main.py (port configurabile via environment), implementata logging infrastructure centralizzata in utils.py/routes.py/api_routes.py/models.py/forms.py, migliorata sicurezza eliminando esposizione dettagli database via print, sistema ora pronto per deployment con best practices implementate
- July 30, 2025: **Sistema Modali Bootstrap e Export Completo** - Sostituito completamente confirm() JavaScript nativo con sistema modali Bootstrap globale per tutte le operazioni di cancellazione: creata modale riutilizzabile con messaggi personalizzati per ogni contesto (note spese, utenti, ruoli, sedi, orari, turni), eliminati messaggi generici del browser "pagina incorporata", sistema automatico di rilevamento form con confirm(), aggiunto export Excel per ferie/permessi e note spese con pulsanti nella UI, colori specifici per stati (approvato/rifiutato/in attesa), export differenziato per admin (tutte) vs utente (solo proprie), correzione errori JavaScript modale con controlli null safety
- July 30, 2025: **Sistema Overlay Ottimizzato con Feedback Export** - Sistema overlay globale attivo su form e navigazione ma escluso da export per evitare attese lunghe: feedback specifico sui pulsanti export con spinner e testo "Generazione in corso", ripristino automatico pulsante dopo 5 secondi, overlay standard su altre operazioni con timeout 30 secondi, soluzione bilanciata per feedback UX immediato su export senza bloccare interfaccia
- July 30, 2025: **Conversione Completa Sistema Export da CSV a Excel** - Convertito completamente tutto il sistema di esportazione da formato CSV a Excel (.xlsx): aggiornate tutte le route da *_csv a *_excel usando libreria openpyxl per server-side export, convertite funzioni JavaScript client-side da CSV a Excel usando libreria SheetJS (XLSX), aggiornate tutte le etichette UI da "CSV" a "Export in Excel", aggiunta libreria XLSX CDN nel base.html, sistema export unificato in formato Excel con stili professionali per tutti i moduli (presenze, turni, interventi, report)
- July 30, 2025: **Dashboard Team Selezione Date e Export Excel Risolti Definitivamente** - Risolto bug critico JavaScript showLoading() che disabilitava input form impedendo invio parametri date, corretta persistenza date selezionate dopo submit form, uniformate colonne export Excel con visualizzazione (Data-Utente-Ruolo-Stato-Entrata-Uscita-Ore Lavorate-Note), rimossa colonna "Sede" da Excel per coerenza con interfaccia, fixato errore UnboundLocalError nell'export, sistema completamente funzionante per selezione periodi personalizzati e export dati
- July 30, 2025: **Dashboard Team Interface Semplificata Completata** - Rimossi controlli navigazione temporale (Giorno/Settimana/Mese) e frecce avanti/indietro, implementato solo range date personalizzato preimpostato con data odierna, aggiunto filtraggio automatico giorni non lavorativi (weekend, festivi, giorni senza orari), corretti errori Holiday model e days_of_week format handling, sistema caricamento spinner mantenuto per operazioni lente, interfaccia ora estremamente semplificata e user-friendly

## Recent Changes
- July 31, 2025: **Sistema Selezione Progressiva Veicoli ACI Implementato** - Implementato sistema completo di filtri progressivi per selezione veicoli ACI nella gestione utenti: selezione tipo → marca → modello come nella visualizzazione tabelle ACI, API dedicate /api/aci/marche/<tipo> e /api/aci/modelli/<tipo>/<marca>, JavaScript per popolazione dinamica dropdown con disable/enable intelligente, gestione corretta valori esistenti in modifica utente, interfaccia user-friendly con filtri a cascata per creazione e modifica utenti
- July 31, 2025: **Sistema QR Code Validazione Stato Utente Implementato** - Aggiunto controllo intelligente dello stato utente nel sistema QR code: impedisce registrazione entrata se utente già presente, impedisce registrazione uscita se utente non presente, messaggi di errore specifici per ciascun caso, validazione tramite AttendanceEvent.get_user_status() per evitare registrazioni duplicate o errate
- July 31, 2025: **Sistema Assegnazione Veicoli ACI Completato** - Implementato sistema completo per assegnare veicoli ACI agli utenti: aggiunto campo aci_vehicle_id al modello User con relazione foreign key, aggiornato UserForm con dropdown selezione veicolo formato "MARCA MODELLO (€x.xxxx/km)", integrati template user_management.html e edit_user.html con colonna visualizzazione veicolo assegnato, aggiornate route new_user e edit_user per gestione campo veicolo, sistema pronto per future funzionalità rimborsi chilometrici
- July 31, 2025: **Errore QR Code Coercizione Risolto** - Risolto errore 500 nella registrazione presenze tramite QR code causato da problema coercizione campo sede_id: cambiata coercizione AttendanceForm da int diretto a lambda per gestione sicura stringhe vuote, sistema QR code ora completamente funzionante senza errori di validazione
- July 31, 2025: **Feedback Visivo Pulsanti Presenze Implementato** - Aggiunto feedback visivo ai pulsanti Entrata/Uscita/Pausa/Ripresa: durante l'operazione mostrano "Registrazione in corso..." con spinner animato, pulsante disabilitato fino al completamento operazione, ripristino automatico testo originale in caso di errore, migliorata user experience per evitare doppi click e fornire feedback immediato
- July 31, 2025: **Errore Timezone Attendance Corretto** - Risolto errore 500 nella pagina attendance causato da timezone comparison nel file utils.py: aggiunta gestione timezone corretta in check_user_schedule_with_permissions(), tutti i datetime ora utilizzano timezone italiano 'Europe/Rome', risolto confronto tra datetime naive/aware che causava TypeError, sistema presenze ora completamente funzionante
- July 31, 2025: **Dashboard Team Accesso Sede Corretto per Management** - Corretto problema dove utenti Management/Responsabile vedevano presenze di tutte le sedi invece che solo della propria: implementata logica coerente con route attendance, utenti Responsabile/Management ora vedono solo utenti e sede della propria sede (sede_id), mantenuto accesso completo per Amministratori e utenti all_sedi, dashboard ora rispetta correttamente le limitazioni per sede
- July 31, 2025: **Sistema Aggregazione Presenze Giornaliere Ottimizzato** - Corretto sistema aggregazione eventi presenze per mostrare primo ingresso e ultimo orario uscita della giornata: aggiunta conversione timezone corretta con convert_to_italian_time(), metodo get_events_as_records ora mostra correttamente prima entrata e ultima uscita per giornate con multiple sessioni, calcolo ore lavorate basato su somma completa di tutte le sessioni tramite get_daily_work_hours(), risolto errore timezone comparison tra datetime naive/aware
- July 31, 2025: **Colonne Sede Aggiunte a Tutte le Liste Presenze** - Aggiunta colonna "Sede" in tutte le tabelle delle presenze: dashboard_team.html, dashboard_sede.html, attendance.html ora mostrano informazione sede con badge colorati, migliore identificazione utenti multi-sede, visualizzazione coerente dell'appartenenza sede per tutti gli utenti nelle liste presenze, colonna sede ora visibile anche in "Le Mie Presenze" per coerenza interfaccia
- July 31, 2025: **Sistema Multi-Sede Registrazione Presenze Completato** - Implementato sistema completo multi-sede per registrazione presenze: selezione sede dinamica nel dashboard per utenti multi-sede, JavaScript validazione sede prima registrazione, route backend aggiornate per supportare parametro sede_id, rimossi messaggi conferma da pulsanti entrata/uscita/pausa/ripresa, sistema streamlined per workflow presenze multi-sede
- July 31, 2025: **Sistema QR Code URL Links Completamente Risolto** - Risolto definitivamente il problema link QR code che puntavano alla route sbagliata: corretti tutti i template (admin_qr_codes.html, view_qr_codes.html, login.html) da url_for('qr_page') a link diretti /qr_login/entrata e /qr_login/uscita, eliminate tutte le funzioni JavaScript che usavano route obsolete, sistema QR code ora completamente funzionante sia per visualizzazione che per accesso pagine dedicate
- July 31, 2025: **Sistema QR Code Completamente Risolto e LSP Errors Eliminati** - Risolto definitivamente il problema QR code "Errore nel caricamento": corretti URL da /attendance/quick/ a /qr_login/ nella funzione generate_static_qr_codes, template view_qr_codes.html ottimizzato per caricare direttamente file statici da /static/qr/, eliminato fallback API esterna problematico, QR code ora si visualizzano correttamente con file PNG statici validi, sistema completamente funzionante senza errori LSP
- July 31, 2025: **Pacchetto Installazione Locale Completo Creato** - Creato pacchetto installazione completo per uso locale: INSTALLATION_GUIDE_LOCAL.md con setup dettagliato per Windows/Linux/macOS, script automatici install.sh e install.bat per installazione one-click, README_INSTALLATION.md per avvio rapido, VERSION.md con info versione 2.0.3, pacchetto workly-installation-package-complete.tar.gz (295KB) con tutti file necessari, documentazione completa per PostgreSQL setup, ambiente Python virtuale, popolamento dati test, risoluzione problemi comuni
- July 31, 2025: **Sistema Caricamento Lazy ACI Tables Implementato** - Ottimizzate performance pagina ACI con caricamento lazy: record caricati solo dopo applicazione filtri invece che automaticamente, interfaccia a 3 stati (iniziale con messaggio informativo, filtrato con risultati, nessun risultato), statistiche separate Record nel DB vs Record Filtrati, eliminato caricamento automatico di 551 record migliorando drasticamente tempi di risposta, pagina ora si carica istantaneamente mostrando filtri
- July 31, 2025: **Upload Excel File Grandi Completamente Ottimizzato** - Sistema upload Excel ottimizzato per file voluminosi: processamento a batch da 100 record per evitare timeout, validazione dimensione file max 50MB con controllo JavaScript, lettura ottimizzata solo colonne A,B,C con tipi dato forzati, barra progresso JavaScript con feedback real-time, gestione memoria migliorata con commit per batch, test completato con successo su 1436 record senza crash, sistema robusto per deployment produzione
- July 30, 2025: **Sistema Overlay Loading Completamente Risolto** - Eliminati definitivamente tutti gli overlay persistenti che causavano schermo nero dopo export: rimossa funzione showLoadingExport da tutti i template, disabilitata funzione showLoading per prevenire overlay globale, sostituita con feedback solo sui pulsanti per cambio date/export, sistema ora usa solo indicatori locali senza overlay full-screen, risolto problema UX critico che bloccava interfaccia utente dopo operazioni di export Excel
- July 30, 2025: **Dashboard Team Range Date Personalizzato Definitivamente Completato** - Implementata selezione range date personalizzato nella dashboard team: selettore inline con form diretto (senza modal problematico), logica backend completa per gestione period='custom' con parsing parametri start_date/end_date, navigazione temporale mantenuta anche per range personalizzati, layout migliorato con titolo su riga separata, validazione HTML5 con campi required, cambiate tutte le diciture "Oggi" in "Giorno", sistema completo e funzionante per analisi presenze su periodi personalizzati
- July 30, 2025: **Sistema Visualizzazione Assenze Completato** - Risolti completamente i problemi di visualizzazione nella dashboard team: correzione export CSV con gestione sicura attributi user.sede e user.role, ordinamento cronologico dati per data crescente, intestazioni allineate correttamente (Data-Utente-Stato-Entrata-Uscita-Ore), visualizzazione assenze per utenti senza registrazione presenza (status="Assente" con badge rosso), logica forzatura status='out' per giorni senza eventi/congedi, sistema completo per tracciamento presenze/assenze giornaliere
- July 30, 2025: **Dashboard Team Dettagli Giorno-per-Giorno Completato** - Modificata dashboard team per mostrare dettagli completi giorno per giorno nelle viste settimana/mese: data come prima colonna per migliore leggibilità, nascosto utenti per date future (non mostrati come assenti), ogni giorno visualizzato singolarmente con stato/entrata/uscita/ore, export CSV aggiornato con ordine cronologico, navigazione temporale completa funzionante, sistema completamente ottimizzato per analisi presenze dettagliate
- July 30, 2025: **Dashboard Team Presenze con Navigazione Temporale e Export Completato** - Implementata navigazione temporale completa nella dashboard team: visualizzazione giornaliera/settimanale/mensile delle presenze, statistiche aggregate per periodi lunghi (ore totali, giorni lavorati, media ore/giorno), funzionalità export CSV con intestazioni dinamiche, controlli periodo-specifici nell'interfaccia, sistema completo per analisi presenze multi-periodo con mantenimento compatibilità esistente
- July 30, 2025: **Navigazione Temporale Reperibilità Completata** - Aggiunta navigazione frecce sinistra/destra per settimane e mesi nella pagina reperibilità: controlli temporali con date navigation, visualizzazione periodo corrente formattata, mantenimento parametri vista durante navigazione, supporto completo per date future e passate, interfaccia migliorata per accesso turni reperibilità storici e futuri
- July 30, 2025: **Separazione Funzionalità Visualizzazione da Gestione Completata** - Implementata completa separazione tra permessi di gestione e visualizzazione: pagine "Visualizza" ora puramente read-only senza form di creazione o azioni di modifica, controlli condizionali `can_manage_* AND can_view_*` per azioni, badge "Solo visualizzazione" per utenti view-only, form creazione nascosti nelle pagine di sola visualizzazione (Ruoli, Utenti, Sedi, Orari), sistema permission-based granulare completamente funzionante
- July 30, 2025: **UI Sidebar Sottomenu Modernizzati** - Restyling completo sottomenu sidebar: corretta identificazione classe `sidebar-submenu-link`, icone ottimizzate 14px con font-size 0.7rem, testo 0.8rem, margin-right 1.5rem per migliore spaziatura, stile coerente con menu principale, interfaccia più professionale e leggibile
- July 29, 2025: **Ottimizzazione Completa Codice Workly Completata** - Implementata configurazione centralizzata in config.py per eliminare valori hardcoded, rimossi 5 file obsoleti (api_routes_old.py, migrate_*.py, init_*.py), consolidati file JavaScript (presidio_scripts.js → main.js), aggiornati template per usare configurazione dinamica, implementato context processor per config globale, paths centralizzati per QR/uploads, eliminati riferimenti ruoli hardcoded, applicazione ottimizzata per manutenibilità e scalabilità con riduzione 31% file Python e 50% file JS, codebase pulito e pronto per deployment
- July 29, 2025: **Template Edit Role Visibilità Definitivamente Risolto** - Corretti completamente tutti i problemi di testo bianco su sfondo bianco nella pagina modifica ruoli: rimossi tutti i riferimenti bg-dark e text-white, sostituiti con card border e header colorati, sezione Widget Dashboard convertita con bg-light per migliore leggibilità, layout migliorato con container-fluid e padding, sistema permessi Note Spese completamente funzionante
- July 29, 2025: **Sistema Note Spese Menu Sidebar e Widget Dashboard Completato** - Spostato menu Note Spese dalla navbar alla sidebar laterale con sottomenu organizzato (Crea, Visualizza, Gestisci Categorie), aggiunto permesso configurabile can_view_expense_reports_widget per amministratori, implementato widget dashboard completo con statistiche (totale note, in attesa, approvate, totale mensile), tabella note spese recenti, controlli permessi granulari per visualizzazione, interfaccia coerente con altri widget del sistema, configurazione completa nel pannello gestione ruoli
- July 29, 2025: **Sistema Messaggistica Interna Multi-Destinatario Completato** - Implementato sistema completo di messaggistica interna: separazione funzionalità "Invia Messaggio" da "Visualizza Messaggi", form SendMessageForm con selezione multipla destinatari, controlli permessi per sede (stesso sede o accesso globale), invio automatico notifiche per approvazioni/rifiuti richieste ferie, badge notifiche ottimizzato nella navbar, pulsanti selezione tutti/nessuno per migliore usabilità, messaggi categorizzati per tipologia (Informativo, Successo, Attenzione, Urgente)
- July 25, 2025: **UI MODERNIZZAZIONE SIDEBAR COMPLETATA** - Conversione completa dell'interfaccia da menu orizzontale a sidebar moderna: layout responsive con toggle mobile, correzione di tutti gli endpoint problematici (can_receive_messages→can_view_messages, user_profile→user_management), rimozione riferimenti hardcoded ruolo 'Ente', risoluzione errori LSP nel models.py (rimozione metodi duplicati, correzione costruttore WorkSchedule), applicazione completamente funzionante con nuova interfaccia sidebar elegante e user-friendly
- July 25, 2025: **Sistema Validazione e Notifiche Richieste Completato** - Implementata validazione avanzata per prevenire richieste retroattive: controllo timezone-aware per permessi nella stessa giornata, validazione JavaScript real-time per orari, correzione bug TypeError datetime comparison. Sistema notifiche automatiche aggiornato: sostituiti controlli ruoli hardcoded con permessi dinamici can_approve_leave(), notifiche inviate solo ad approvatori della stessa sede o multi-sede. Migliorata logica sovrapposizione permessi: permessi multipli nella stessa giornata consentiti se orari non si sovrappongono, controllo orario granulare vs controllo date per ferie/malattie. Smart redirect: cancellazioni da widget dashboard rimangono in dashboard, cancellazioni da pagine complete ritornano alle pagine originali
- July 25, 2025: **Nuovi Widget Dashboard Personali Completati** - Implementati tre nuovi widget dashboard: "Le Mie Richieste Ferie/Permessi/Malattie" con tabella completa e colori stato, "I Miei Turni" per visualizzare turni futuri assegnati, "Le Mie Reperibilità" per reperibilità personali, tutti i widget larghi col-12 con layout responsive, controlli permessi implementati can_view_my_leave_requests_widget/can_view_my_shifts_widget/can_view_my_reperibilita_widget, interfaccia gestione ruoli aggiornata con nuovi permessi, risolto errore 500 ReperibilitaShift.start_date corretto in .date, sistema completamente funzionante
- July 24, 2025: **Sistema Permessi Granulari Presenze DEFINITIVAMENTE RISOLTO** - Creato permesso specifico `can_view_sede_attendance` per separare completamente accesso presenze personali da presenze sede, aggiornato database con nuovo permesso (false per tutti i ruoli di default), rimosso metodo duplicato `can_view_sede_attendance()` che causava override del controllo corretto, ora utenti Operatore vedono solo "Le Mie Presenze" senza accesso a "Presenze Sede", sistema granulare completamente funzionante e testato
- July 24, 2025: **Sistema Menu Dinamico 1:1 con Permessi Completato** - Implementata mappatura diretta tra permessi JSON e voci di menu: ogni macro categoria permessi (Ruoli, Utenti, Sedi, Orari, Turni, Reperibilità, Presenze, Ferie/Permessi, Festività, QR, Report, Messaggi) corrisponde a una voce di menu che appare solo se l'utente ha almeno un permesso della categoria, sottomenu dinamici basati sui permessi specifici (can_manage_* vs can_view_*), sistema completamente dinamico senza hardcoding, sottomenu Presenze ottimizzato con funzionalità specifiche (Le Mie Presenze, Presenze Sede, Dashboard Presenze), "Presenze Sede" ora correttamente utilizza view=sede per mostrare presenze della sede specifica, utenti multi-sede vedono presenze organizzate per sede con tabelle separate e badge conteggio presenze per sede, storico presenze team include ferie/permessi/malattie approvate per tutti gli utenti visibili
- July 24, 2025: **Sistema Presidio Coverage UI Completato** - Trasformata pagina presidio_coverage in tabella pulita con azioni Modifica-Cancella, rimosso pulsante "Vista Sola Lettura" e azione "Visualizza", pagina presidio_detail ora puramente read-only senza pulsante modifica, interfaccia completamente unificata e professionale
- July 24, 2025: **Sistema Doppia Segnalazione Ruoli Confermato** - Confermata logica corretta per giorni scoperti: ruoli specifici mancanti ("Supervisore mancante 10:00-17:00") + etichetta generale "SCOPERTO" quando nessun turno è assegnato, fornisce informazioni sia dettagliate che panoramiche per migliore gestione coperture
- July 24, 2025: **Sistema Evidenziazione Missing Roles COMPLETATO SU ENTRAMBE LE PAGINE** - Implementata logica dinamica missing_roles su turni_automatici.html E visualizza_turni.html: sistema legge coperture presidio dal database, calcola dinamicamente ruoli mancanti per sovrapposizione oraria, evidenziazione gialla funzionante per tutti i template, sistema completamente dinamico e unificato tra le due pagine
- July 24, 2025: **Database Template Presidio Pulito** - Eliminati tutti i template presidio esistenti per consentire creazione di nuovi template di test per verificare sistema evidenziazione ruoli mancanti, database presidio completamente resettato
- July 24, 2025: **Div Template Selezionato Rimosso Definitivamente** - Eliminata sezione "Template Selezionato" problematica anche dalla pagina confirm_regenerate_shifts.html, interfaccia completamente pulita senza elementi invisibili
- July 24, 2025: **Errori CSRF e Visibilità Template Risolti** - Corretto errore "CSRF token missing" aggiungendo csrf_token() nei form eliminazione coperture presidio, rimosso div template selezionato problematico e semplificata interfaccia per migliore usabilità
- July 24, 2025: **Colonna Sede Aggiunta a View Presidi** - Aggiunta colonna "Sede" nella tabella template copertura presidio in view_presidi.html, mostra nome sede specifica o "Tutte le sedi" se template globale, migliore identificazione template per sede con badge colorati
- July 24, 2025: **Visibilità Template e Controllo Coperture Perfezionati** - Applicato contrasto estremo (nero/bianco) per template selezionato garantendo visibilità massima, migliorato controllo coperture per verificare ogni ruolo singolarmente inclusi Supervisore/Responsabile mancanti, sistema avvisi ora completamente accurato e template chiaramente leggibile
- July 24, 2025: **Sistema Rigenerazione Turni con Avvisi Completato** - Implementato sistema completo di conferma rigenerazione che protegge turni passati, migliorata visibilità template selezionato con contrasti corretti, aggiunto controllo preventivo disponibilità utenti con avvisi specifici per coperture insufficienti per giorno/orario, sistema ora genera turni anche con utenti limitati e informa l'amministratore delle carenze
- July 24, 2025: **Filtro Utenti "Turni" per Generazione Automatica RISOLTO** - Corretto bug nella funzione genera_turni_da_template: rimosso isouter=True dal join WorkSchedule per garantire filtro corretto, ora considera SOLO utenti con orario "Turni" assegnato (esempio: Marco Operatore1 e Gianni Operatore2), esclusi correttamente utenti con altri orari come "Orario per sede Turni" (esempio: Paolo Operatore), sistema ora completamente funzionale
- July 24, 2025: **Aggiunta Colonna Sede e Pulizia Visualizzazioni** - Aggiunta informazione sede in tutte le visualizzazioni presidi (presidio_coverage.html, presidio_detail.html, turni_automatici.html, visualizza_turni.html), rimossa sezione obsoleta "Template Presidio Disponibili" dalla pagina visualizza_turni che mostrava dati inconsistenti, migliore leggibilità con sede chiaramente identificata in ogni template
- July 24, 2025: **Rimossa Logica Hardcoded Ruoli** - Eliminati tutti i riferimenti hardcoded a ruoli specifici (Redattore, Sviluppatore, Operatore, Admin, Ente) e sostituiti con gestione dinamica: escluso solo "Amministratore" da turnazioni, controlli autorizzazione aggiornati per supportare utenti multi-sede, sistema completamente dinamico basato su ruoli configurabili
- July 24, 2025: **Filtro Utenti "Turni" per Generazione Automatica** - Aggiornata logica generazione turni per considerare SOLO utenti con orario "Turni" assegnato: algoritmi presidio e reperibilità, form creazione turni manuali, fallback coverage, sistema ora rispetta completamente l'assegnazione orari per determinare eligibilità turnazioni
- July 24, 2025: **Sistema Orario "Turni" Implementato** - Creata tipologia orario speciale "Turni" per sedi con modalità turnazione, automaticamente generato per sedi turni-abilitate, controllo presenze disabilitato per utenti con orario "Turni" o nessun orario (possono registrare entrata/uscita senza controllo ritardi/anticipi), maggiore leggibilità con etichetta "Modalità Turnazioni"
- July 24, 2025: **Sistema Orari Utente Completato e Funzionante** - Sistema completo di assegnazione orari per sedi con doppia modalità (TURNI/ORARIA): utenti sede specifica possono scegliere orario per modalità ORARIA o lasciare vuoto per modalità TURNI, utenti multi-sede non necessitano orario, errore "Not a valid choice" risolto con validazione choices disabilitata
- July 24, 2025: **Sistema Selezione Orari Utente Implementato** - Aggiunto campo work_schedule_id al modello User, implementata selezione dinamica orari basata su sede nel form utenti, creata route API /api/sede/<id>/work_schedules, JavaScript per popolamento dinamico dropdown orari, validazione form per coerenza sede-orario, tabella utenti aggiornata con colonna orario
- July 24, 2025: **Errore 500 Template Sede Risolto** - Corretto errore TypeError nel template edit_sede.html: sostituito sede.work_schedules|length con sede.work_schedules.count() per gestire correttamente relazioni SQLAlchemy AppenderQuery
- July 24, 2025: **Form Utenti Sistemati Completamente** - Rimosso checkbox duplicato "Accesso a tutte le sedi" dal form modifica utente, campo "% Lavoro" ora presente e sempre visibile per TUTTI i ruoli (incluso Redattore) sia nel form creazione che modifica, rimossi controlli hardcoded che limitavano il campo solo a Responsabile/Operatore
- July 24, 2025: **Widget Statistiche Team Corretto** - Risolto bug visualizzazione ruoli nel widget: ora mostra TUTTI i ruoli attivi incluso "Ospite" con 0 utenti, corretti import UserRole e logica inizializzazione contatori
- July 24, 2025: **Tabella Utenti Corretta** - Risolti errori visualizzazione colonne in user_management.html: rimossi header duplicati, corretta logica visualizzazione ruolo e percentuale part-time per ruoli appropriati (Responsabile/Operatore)
- July 24, 2025: **Sistema Reset Password Ripristinato e Completato** - Ripristinata tabella password_reset_token e implementato sistema completo gestione reset password: route forgot_password e reset_password funzionanti, generazione token sicuri con scadenza 1 ora, template dedicati con validazione form, link "Password dimenticata?" nella pagina login, sistema pronto per integrazione email
- July 24, 2025: **Pulizia Completa Progetto Completata** - Rimossi completamente tutti i file obsoleti di migrazione/setup (16 file), puliti form legacy con riferimenti ruoli hardcoded, eliminati statement di debug temporanei, pulizia codice duplicato in forms.py, progetto ottimizzato con solo file essenziali attivi
- July 24, 2025: **Permessi Widget per Amministratore Abilitati** - L'amministratore ora può modificare solo i permessi Widget di tutti i ruoli: rimossa protezione completa dal ruolo Amministratore, aggiunta logica condizionale per permettere modifica Widget-only, nascosti campi nome/descrizione/stato per amministratore, badge "Widget Only" per identificazione, sistema sicuro che mantiene altri permessi intatti
- July 23, 2025: **Widget Dashboard Template-Based Completati** - Widget Copertura Turni e Reperibilità ora mostrano template invece di singoli turni: aggiornata logica backend per query template, corretta visualizzazione con nome template e periodo validità, rimossi 39 turni inappropriati dalla Sede Principale (tipologia Oraria), creato template reperibilità di esempio, sistema completamente basato su template per migliore organizzazione
- July 23, 2025: **Sistema Modifica Turni Intelligente Completato** - Implementato sistema completo di modifica turni con filtro intelligente: estrazione automatica data turno dal DOM, filtro utenti disponibili per data specifica escludendo già impegnati, visualizzazione nomi completi invece di username, gestione CSRF corretta, refresh automatico dopo modifica con mantenimento vista template, debug completo per troubleshooting
- July 23, 2025: **Sistema Turni Automatici Completo** - Sostituito completamente vecchio sistema turni manuale con nuovo sistema automatico basato su template presidio: implementata route turni_automatici con generazione automatica da PresidioCoverageTemplate, eliminati campi data manuali (ora prelevate automaticamente dal template), aggiornato menu navigazione con "Gestione Template Presidio", "Turni Automatici", "Visualizza Presidi", sistema intelligente di selezione ruoli e bilanciamento carichi di lavoro
- July 22, 2025: **Sistema Gestione Coperture Presidio Completo** - Implementato sistema completo gestione coperture: creazione nuove coperture con template create_presidio_coverage, generazione/rigenerazione turni automatica da template, interfaccia selezione ruoli interattiva con checkbox e quantità, validazione sovrapposizioni periodi, aggiornate informazioni funzionalità nella gestione coperture, sistema completamente funzionale per creazione template e generazione turni
- July 22, 2025: **Sistema Visualizzazione/Modifica Template Presidio Completo** - Implementate funzionalità complete per template coperture presidio: route view_presidio_coverage e edit_presidio_coverage, template dedicati con visualizzazione orari/pause separati, form modifica con validazione JavaScript per pause, logica backend per salvataggio modifiche con parsing ruoli, lista template semplificata senza orari (variano per giorno), corretta denominazione "Sede Turni"
- July 22, 2025: **Correzione Gestione Coperture Presidio** - Risolti errori 500 in "Gestione Coperture": corretto uso modello PresidioCoverage per coperture di presidio (non ReperibilitaCoverage per reperibilità), aggiornati titoli da "reperibilità" a "presidio", corretti link azioni per funzionalità presidio, sistema ora mostra correttamente template coperture presidio raggruppati per periodo
- July 21, 2025: **Menu Turni Riorganizzato in 3 Funzionalità** - Implementata nuova struttura menu Turni: 1) Gestione Coperture (gestione coperture presidio per sede), 2) Gestione Turni (creazione/modifica turni esistente), 3) Visualizza Turni (visualizzazione read-only per copertura selezionata), aggiunti permessi granulari can_manage_coverage/can_view_coverage, creati template dedicati, supporto completo multi-sede, admin ora vede correttamente sottomenu Gestione Coperture
- July 21, 2025: **Sistema Turni Completo Multi-Sede Funzionante** - Risolto completamente accesso turni per utenti multi-sede: menu Turni visibile e funzionante, route /shifts mostra 25 turni esistenti per admin/supervisore, template di turnazione visualizzabili (creato esempio "Template Agosto 2025"), sistema completo con statistiche turni, calendario e gestione avanzata, supporto dinamico per utenti all_sedi e sede-specifici
- July 21, 2025: **Menu Turni Dinamico per Utenti Multi-Sede** - Risolto accesso menu turni per utenti all_sedi: aggiornato can_access_shifts_menu() per supportare utenti multi-sede, creato metodo get_turni_sedi() per gestione dinamica accesso sedi turni, aggiornate route manage_turni, generate_turnazioni e shifts per utilizzo logica unificata, sistema ora supporta utenti globali con accesso a tutte le sedi turni
- July 21, 2025: **Sistema Presenze Dinamico per Sede Completato** - Implementato sistema completo per visualizzazione presenze per sede: supporto utenti all_sedi (multi-sede), permessi granulari can_access_attendance e can_view_attendance, pulsanti dinamici "Le Mie"/"Sede" configurabili dall'admin, risolto accesso per utenti Supervisore con accesso globale, sistema completamente dinamico basato su permessi
- July 21, 2025: **Controlli Turni Basati su Modalità Sede** - Implementati controlli completi per nascondere menu e funzionalità turni quando sede non supporta modalità "Turni": menu navigazione condizionato, route protette con validazione sede, template con messaggi informativi, sistema completamente dinamico basato su sede.is_turni_mode()
- July 21, 2025: **Correzione Errori Menu Turni** - Risolti errori 500 nel menu turni: corretti tutti riferimenti endpoint da presidio_coverage a reperibilita_coverage, implementati controlli condizionali nel template, aggiunta validazione sede per tutte le route di gestione turni
- July 21, 2025: **Protezione Amministratore** - Implementata protezione completa contro cancellazione/disattivazione dell'utente amministratore: bloccata route toggle_user, aggiunto controllo nel form di modifica, disabilitato checkbox nel template edit_user.html, sostituito pulsante toggle con icona "protetto" nell'interfaccia utente
- July 21, 2025: **Statistiche Utenti per Ruolo in Dashboard** - Aggiunta sezione "Statistiche Utenti" nella dashboard che mostra il numero di utenti per ogni ruolo con colori specifici (Amministratore: rosso, Responsabile: blu, Supervisore: giallo, Operatore: azzurro, Ospite: grigio), implementata logica backend in get_team_statistics()
- July 21, 2025: **Eliminazione Riferimenti Fissi ai Ruoli** - Rimossi tutti i riferimenti hardcoded ai ruoli obsoleti (Admin, Management, Ente, Staff, etc.) da template e route, sostituiti con controlli dinamici basati sui permessi, implementato metodo has_role() per controlli specifici sui ruoli quando necessario
- July 21, 2025: **Sistema All_Sedi Implementato** - Aggiunto campo all_sedi al database utenti, aggiornati form e template per gestire accesso globale a tutte le sedi, implementata logica di validazione e JavaScript per gestione interazione tra campi sede specifica e accesso globale
- July 21, 2025: **Dashboard Admin Pulita** - Rimossa sezione registrazione presenze (Entrata/Uscita/Pausa/Ripresa) per amministratori, aggiornati controlli per escludere ruolo 'Amministratore' dalle funzionalità operative, mantenute solo funzioni di gestione e supervisione
- July 21, 2025: **Sistema Permessi Granulari Completo** - Implementato sistema completo di 30+ permessi granulari per ogni funzionalità del menu (gestione/visualizzazione), eliminati tutti i riferimenti ai vecchi ruoli legacy, creati 5 nuovi ruoli standardizzati: Amministratore, Responsabile, Supervisore, Operatore, Ospite con permessi specifici
- July 21, 2025: **Controlli Autorizzazione Basati su Permessi** - Migrate tutte le route da controlli diretti sui ruoli a metodi granulari di permesso (can_manage_users, can_view_shifts, etc.), aggiornato menu di navigazione con ordine specificato: Home - Ruoli - Utenti - Sedi - Orari - Turni - Reperibilità - Festività - Gestione QR - Statistiche
- July 18, 2025: **Range Orari Flessibili** - Implementati range orari di entrata e uscita (start_time_min/max, end_time_min/max) sostituendo orari fissi, aggiornati modelli con metodi di visualizzazione range, form con validazioni, template con input group e JavaScript per sincronizzazione automatica min/max
- July 18, 2025: **Selezione Giorni Settimana Orari** - Aggiunto campo days_of_week al modello WorkSchedule, implementati preset (Lun-Ven, Sab-Dom, Tutti giorni, Personalizzato), aggiornati form e template con JavaScript per sincronizzazione automatica, visualizzazione giorni nella tabella orari
- July 18, 2025: **Sistema Controllo Orari Sede con Permessi** - Implementato controllo intelligente entrate/uscite basato su orari sede invece di turni, considera permessi approvati per calcolo ritardi/anticipi, aggiornato modello LeaveRequest con campi start_time/end_time per permessi orari
- July 18, 2025: **Progetto Workly Creato** - Clone completo e indipendente della piattaforma NS12 con branding generico "Workly Platform", rimosso logo aziendale, aggiornati tutti i template e riferimenti, creati README.md e configurazione .replit per deployment autonomo

## User Preferences

Preferred communication style: Simple, everyday language.