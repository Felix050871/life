{% extends "base.html" %}

{% block title %}Scheda HR - {{ user.get_full_name() }} - Life Platform{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="mb-0">
        <i class="fas fa-id-card me-2"></i>
        Scheda HR - {{ user.get_full_name() }}
    </h1>
    <a href="{{ url_for('hr.hr_list') }}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left me-2"></i>Torna alla Lista
    </a>
</div>

<form method="POST" action="{{ url_for('hr.hr_detail', user_id=user.id) }}">
    <!-- Dati Anagrafici -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h5 class="card-title mb-0">
                <i class="fas fa-user me-2"></i>Dati Anagrafici
            </h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label class="form-label">Matricola</label>
                    <input type="text" name="matricola" class="form-control" 
                           value="{{ hr_data.matricola or '' }}" 
                           {% if not can_edit %}disabled{% endif %}>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Codice Fiscale</label>
                    <input type="text" name="codice_fiscale" class="form-control text-uppercase" 
                           value="{{ hr_data.codice_fiscale or '' }}" 
                           maxlength="16"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Sesso</label>
                    <select name="gender" class="form-select" {% if not can_edit %}disabled{% endif %}>
                        <option value="">Seleziona...</option>
                        <option value="M" {% if hr_data.gender == 'M' %}selected{% endif %}>Maschile</option>
                        <option value="F" {% if hr_data.gender == 'F' %}selected{% endif %}>Femminile</option>
                        <option value="A" {% if hr_data.gender == 'A' %}selected{% endif %}>Altro</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label class="form-label">Data di Nascita</label>
                    <input type="date" name="birth_date" class="form-control" 
                           value="{{ hr_data.birth_date.strftime('%Y-%m-%d') if hr_data.birth_date else '' }}"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Città di Nascita</label>
                    <input type="text" name="birth_city" class="form-control" 
                           value="{{ hr_data.birth_city or '' }}"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
                <div class="col-md-2 mb-3">
                    <label class="form-label">Provincia</label>
                    <input type="text" name="birth_province" class="form-control text-uppercase" 
                           value="{{ hr_data.birth_province or '' }}" 
                           maxlength="2"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Paese di Nascita</label>
                    <input type="text" name="birth_country" class="form-control" 
                           value="{{ hr_data.birth_country or 'Italia' }}"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
            </div>
        </div>
    </div>

    <!-- Residenza -->
    <div class="card mb-4">
        <div class="card-header bg-secondary text-white">
            <h5 class="card-title mb-0">
                <i class="fas fa-home me-2"></i>Residenza
            </h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-8 mb-3">
                    <label class="form-label">Indirizzo</label>
                    <input type="text" name="address" class="form-control" 
                           value="{{ hr_data.address or '' }}"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">CAP</label>
                    <input type="text" name="postal_code" class="form-control" 
                           value="{{ hr_data.postal_code or '' }}" 
                           maxlength="10"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
            </div>
            <div class="row">
                <div class="col-md-5 mb-3">
                    <label class="form-label">Città</label>
                    <input type="text" name="city" class="form-control" 
                           value="{{ hr_data.city or '' }}"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
                <div class="col-md-2 mb-3">
                    <label class="form-label">Provincia</label>
                    <input type="text" name="province" class="form-control text-uppercase" 
                           value="{{ hr_data.province or '' }}" 
                           maxlength="2"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
                <div class="col-md-5 mb-3">
                    <label class="form-label">Paese</label>
                    <input type="text" name="country" class="form-control" 
                           value="{{ hr_data.country or 'Italia' }}"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
            </div>
        </div>
    </div>

    <!-- Dati Contrattuali -->
    <div class="card mb-4">
        <div class="card-header bg-info text-white">
            <h5 class="card-title mb-0">
                <i class="fas fa-file-contract me-2"></i>Dati Contrattuali
            </h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label class="form-label">Tipo Contratto</label>
                    <select name="contract_type" class="form-select" {% if not can_edit %}disabled{% endif %}>
                        <option value="">Seleziona...</option>
                        <option value="Tempo Indeterminato" {% if hr_data.contract_type == 'Tempo Indeterminato' %}selected{% endif %}>Tempo Indeterminato</option>
                        <option value="Tempo Determinato" {% if hr_data.contract_type == 'Tempo Determinato' %}selected{% endif %}>Tempo Determinato</option>
                        <option value="Apprendistato" {% if hr_data.contract_type == 'Apprendistato' %}selected{% endif %}>Apprendistato</option>
                        <option value="Stage" {% if hr_data.contract_type == 'Stage' %}selected{% endif %}>Stage</option>
                        <option value="Collaborazione" {% if hr_data.contract_type == 'Collaborazione' %}selected{% endif %}>Collaborazione</option>
                        <option value="Partita IVA" {% if hr_data.contract_type == 'Partita IVA' %}selected{% endif %}>Partita IVA</option>
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Data Assunzione</label>
                    <input type="date" name="hire_date" class="form-control" 
                           value="{{ hr_data.hire_date.strftime('%Y-%m-%d') if hr_data.hire_date else '' }}"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Inizio Contratto</label>
                    <input type="date" name="contract_start_date" class="form-control" 
                           value="{{ hr_data.contract_start_date.strftime('%Y-%m-%d') if hr_data.contract_start_date else '' }}"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label class="form-label">Fine Contratto (solo TD)</label>
                    <input type="date" name="contract_end_date" class="form-control" 
                           value="{{ hr_data.contract_end_date.strftime('%Y-%m-%d') if hr_data.contract_end_date else '' }}"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Fine Periodo Prova</label>
                    <input type="date" name="probation_end_date" class="form-control" 
                           value="{{ hr_data.probation_end_date.strftime('%Y-%m-%d') if hr_data.probation_end_date else '' }}"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Ore Settimanali</label>
                    <input type="number" name="work_hours_week" class="form-control" 
                           value="{{ hr_data.work_hours_week or '' }}" 
                           step="0.5"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">CCNL Applicato</label>
                    <input type="text" name="ccnl" class="form-control" 
                           value="{{ hr_data.ccnl or '' }}"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">Livello Contrattuale</label>
                    <input type="text" name="ccnl_level" class="form-control" 
                           value="{{ hr_data.ccnl_level or '' }}"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
            </div>
        </div>
    </div>

    <!-- Dati Economici -->
    {% if can_edit or current_user.can_view_hr_data() %}
    <div class="card mb-4">
        <div class="card-header bg-success text-white">
            <h5 class="card-title mb-0">
                <i class="fas fa-euro-sign me-2"></i>Dati Economici
            </h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label class="form-label">RAL (€)</label>
                    <input type="number" name="gross_salary" class="form-control" 
                           value="{{ hr_data.gross_salary or '' }}" 
                           step="0.01"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Netto Mensile (€)</label>
                    <input type="number" name="net_salary" class="form-control" 
                           value="{{ hr_data.net_salary or '' }}" 
                           step="0.01"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Metodo Pagamento</label>
                    <select name="payment_method" class="form-select" {% if not can_edit %}disabled{% endif %}>
                        <option value="">Seleziona...</option>
                        <option value="Bonifico" {% if hr_data.payment_method == 'Bonifico' %}selected{% endif %}>Bonifico</option>
                        <option value="Assegno" {% if hr_data.payment_method == 'Assegno' %}selected{% endif %}>Assegno</option>
                        <option value="Contanti" {% if hr_data.payment_method == 'Contanti' %}selected{% endif %}>Contanti</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 mb-3">
                    <label class="form-label">IBAN</label>
                    <input type="text" name="iban" class="form-control text-uppercase" 
                           value="{{ hr_data.iban or '' }}" 
                           maxlength="34"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Documenti -->
    <div class="card mb-4">
        <div class="card-header bg-warning text-white">
            <h5 class="card-title mb-0">
                <i class="fas fa-id-card-alt me-2"></i>Documenti
            </h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label class="form-label">Tipo Documento</label>
                    <select name="id_card_type" class="form-select" {% if not can_edit %}disabled{% endif %}>
                        <option value="">Seleziona...</option>
                        <option value="Carta Identità" {% if hr_data.id_card_type == 'Carta Identità' %}selected{% endif %}>Carta d'Identità</option>
                        <option value="Patente" {% if hr_data.id_card_type == 'Patente' %}selected{% endif %}>Patente</option>
                        <option value="Passaporto" {% if hr_data.id_card_type == 'Passaporto' %}selected{% endif %}>Passaporto</option>
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Numero Documento</label>
                    <input type="text" name="id_card_number" class="form-control" 
                           value="{{ hr_data.id_card_number or '' }}"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Scadenza Documento</label>
                    <input type="date" name="id_card_expiry" class="form-control" 
                           value="{{ hr_data.id_card_expiry.strftime('%Y-%m-%d') if hr_data.id_card_expiry else '' }}"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
            </div>
        </div>
    </div>

    <!-- Contatto Emergenza -->
    <div class="card mb-4">
        <div class="card-header bg-danger text-white">
            <h5 class="card-title mb-0">
                <i class="fas fa-phone-volume me-2"></i>Contatto Emergenza
            </h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label class="form-label">Nome e Cognome</label>
                    <input type="text" name="emergency_contact_name" class="form-control" 
                           value="{{ hr_data.emergency_contact_name or '' }}"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Telefono</label>
                    <input type="tel" name="emergency_contact_phone" class="form-control" 
                           value="{{ hr_data.emergency_contact_phone or '' }}"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Relazione</label>
                    <select name="emergency_contact_relation" class="form-select" {% if not can_edit %}disabled{% endif %}>
                        <option value="">Seleziona...</option>
                        <option value="Coniuge" {% if hr_data.emergency_contact_relation == 'Coniuge' %}selected{% endif %}>Coniuge</option>
                        <option value="Genitore" {% if hr_data.emergency_contact_relation == 'Genitore' %}selected{% endif %}>Genitore</option>
                        <option value="Figlio/a" {% if hr_data.emergency_contact_relation == 'Figlio/a' %}selected{% endif %}>Figlio/a</option>
                        <option value="Fratello/Sorella" {% if hr_data.emergency_contact_relation == 'Fratello/Sorella' %}selected{% endif %}>Fratello/Sorella</option>
                        <option value="Altro" {% if hr_data.emergency_contact_relation == 'Altro' %}selected{% endif %}>Altro</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Altri Dati -->
    <div class="card mb-4">
        <div class="card-header bg-dark text-white">
            <h5 class="card-title mb-0">
                <i class="fas fa-info-circle me-2"></i>Altri Dati
            </h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label class="form-label">Titolo di Studio</label>
                    <input type="text" name="education_level" class="form-control" 
                           value="{{ hr_data.education_level or '' }}"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Campo di Studio</label>
                    <input type="text" name="education_field" class="form-control" 
                           value="{{ hr_data.education_field or '' }}"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Stato Civile</label>
                    <select name="marital_status" class="form-select" {% if not can_edit %}disabled{% endif %}>
                        <option value="">Seleziona...</option>
                        <option value="Celibe/Nubile" {% if hr_data.marital_status == 'Celibe/Nubile' %}selected{% endif %}>Celibe/Nubile</option>
                        <option value="Coniugato/a" {% if hr_data.marital_status == 'Coniugato/a' %}selected{% endif %}>Coniugato/a</option>
                        <option value="Divorziato/a" {% if hr_data.marital_status == 'Divorziato/a' %}selected{% endif %}>Divorziato/a</option>
                        <option value="Vedovo/a" {% if hr_data.marital_status == 'Vedovo/a' %}selected{% endif %}>Vedovo/a</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label class="form-label">Familiari a Carico</label>
                    <input type="number" name="dependents_number" class="form-control" 
                           value="{{ hr_data.dependents_number or '' }}" 
                           min="0"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="form-check mt-4">
                        <input type="checkbox" name="disability" class="form-check-input" 
                               {% if hr_data.disability %}checked{% endif %}
                               {% if not can_edit %}disabled{% endif %}>
                        <label class="form-check-label">
                            Disabilità Certificata
                        </label>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Percentuale Disabilità</label>
                    <input type="number" name="disability_percentage" class="form-control" 
                           value="{{ hr_data.disability_percentage or '' }}" 
                           min="0" max="100"
                           {% if not can_edit %}disabled{% endif %}>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 mb-3">
                    <label class="form-label">Note Interne HR</label>
                    <textarea name="notes" class="form-control" rows="4" 
                              {% if not can_edit %}disabled{% endif %}>{{ hr_data.notes or '' }}</textarea>
                </div>
            </div>
        </div>
    </div>

    {% if can_edit %}
    <div class="d-grid gap-2 d-md-flex justify-content-md-end mb-4">
        <a href="{{ url_for('hr.hr_list') }}" class="btn btn-outline-secondary">
            <i class="fas fa-times me-2"></i>Annulla
        </a>
        <button type="submit" class="btn btn-primary">
            <i class="fas fa-save me-2"></i>Salva Modifiche
        </button>
    </div>
    {% endif %}
</form>

{% endblock %}
